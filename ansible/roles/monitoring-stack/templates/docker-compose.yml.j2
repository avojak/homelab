---
version: '3.3'
services:
  influxdb:
    image: "influxdb:{{ influxdb_version }}"
    container_name: influxdb
    restart: always
    ports:
      - "{{ influxdb_port }}:8086"
    environment:
      - "DOCKER_INFLUXDB_INIT_MODE={{ influxdb_mode }}"
      - "DOCKER_INFLUXDB_INIT_USERNAME={{ influxdb_username }}"
      - "DOCKER_INFLUXDB_INIT_PASSWORD={{ influxdb_password }}"
      - "DOCKER_INFLUXDB_INIT_ORG={{ influxdb_org }}"
      - "DOCKER_INFLUXDB_INIT_BUCKET={{ influxdb_bucket }}"
      - "DOCKER_INFLUXDB_INIT_RETENTION={{ influxdb_retention }}"
      - "DOCKER_INFLUXDB_INIT_ADMIN_TOKEN={{ influxdb_admin_token }}"
    volumes:
      - "{{ influxdb_data_dir }}:/var/lib/influxdb2"
      - "{{ influxdb_config_dir }}:/etc/influxdb2"

  grafana:
    image: "grafana/grafana-oss:{{ grafana_version }}"
    container_name: grafana
    restart: always
    ports:
      - "{{ grafana_port }}:3000"
    environment:
      - "GF_DEFAULT_INSTANCE_NAME=grafana"
      - "GF_SECURITY_ADMIN_USER={{ grafana_admin_user }}"
      - "GF_SECURITY_ADMIN_PASSWORD={{ grafana_admin_password }}"
      - "GF_USERS_ALLOW_SIGN_UP=false"
    volumes:
      - "{{ grafana_data_dir }}:/var/lib/grafana"

  portainer:
    image: "portainer/portainer-ce:{{ portainer_version }}"
    container_name: portainer
    restart: always
    ports:
      - "{{ portainer_port_https }}:9443"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - "{{ portainer_data_dir }}:/data"

  uptime-kuma:
    image: "louislam/uptime-kuma:{{ uptime_kuma_version }}"
    container_name: uptime-kuma
    restart: always
    ports:
      - "{{ uptime_kuma_port }}:3001"
    volumes:
      - "{{ uptime_kuma_data_dir }}:/app/data"